<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">

<body>
<div layout:fragment="content">
    <section>
        <div class="container" style="width: 60%; padding-bottom: 30 px;">

            <span th:if="${selectedCategory != null}">
                <nav aria-label="breadcrumb">
                   <ol class="breadcrumb" style="backgound-color: white; padding-left: 0px">
                       <li class="breadcumb-item active" aria-current="page">
                           <h2 th:text="${selectedCategory.name}"></h2>
                       </li>
                   </ol>
                </nav>
            </span>

            <div class="card shadow-sm bg-white rounded" style="margin-top: 20px;" th:each="post : ${posts}">
                <div class="card-body">

                    <a th:href="${post.slug != null} ? @{/title/{slug}(slug=${post.slug})} : @{/posts}">
                        <h2 class="card-title" style="font-weight: bold; color=black; padding-top: 5px;">
                            <span th:text="${post.title}"></span>
                        </h2>
                    </a>

                    <p class="card-subtitle mb-2 text-muted" style="font-size: 0.8rem;">
                        <span th:text="${#temporals.format(post.createdAt, 'dd/MM/yyyy')}"></span> - by
                        <span th:text="${post.user.username}"></span>
                    </p>

                    <a th:href="${(#mvc.url('PC#getPostDetailed').arg(0, post.id)).build()}">
                        <div th:if="${post.mainImageUrl != null}" style="margin-bottom: 15px;">
                            <img th:src="${post.mainImageUrl}"
                            alt="Post Image"
                            style="max-width: 100%; height: auto; border-radius: 5px;">
                        </div>
                    </a>

                    <p class="card-text">
                        <span th:utext="${#strings.abbreviate(post.body,400)}"></span>
                        <a th:href="${post.slug != null} ? @{/title/{slug}(slug=${post.slug})} : @{/posts}">
                            Read more
                        </a>
                    </p>

                    <p class="card-subtitle mb-2 text-muted" style="font-size: 0.8rem;">
                        <span th:each="category : ${post.categories}">
                            <a th:href="@{/postsbycategory/{id}(id=${category.id})}">
                                <span class="badge badge-secondary" th:text="${category.name}"></span>
                            </a>
                        </span>
                    </p>
                </div>
            </div>

            <!-- Pagination -->
            <div th:if="${totalPages > 1}" class="d-flex justify-content-center align-items-center mt-4 mb-5">
                <nav aria-label="Page navigation">
                    <ul class="pagination pagination-sm">
                        <!-- First page -->
                        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                            <a class="page-link"
                               th:href="${categoryId != null} ? @{/postsbycategory/{id}(id=${categoryId}, page=0)} : @{/posts(page=0)}"
                               th:if="${currentPage > 0}">
                                <span aria-hidden="true">&laquo;&laquo;</span>
                            </a>
                            <span class="page-link" th:if="${currentPage == 0}">
                                <span aria-hidden="true">&laquo;&laquo;</span>
                            </span>
                        </li>

                        <!-- Previous page -->
                        <li class="page-item" th:classappend="${!hasPrev} ? 'disabled'">
                            <a class="page-link"
                               th:href="${categoryId != null} ? @{/postsbycategory/{id}(id=${categoryId}, page=${currentPage - 1})} : @{/posts(page=${currentPage - 1})}"
                               th:if="${hasPrev}">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                            <span class="page-link" th:if="${!hasPrev}">
                                <span aria-hidden="true">&laquo;</span>
                            </span>
                        </li>

                        <!-- Numbered pages -->
                        <th:block th:with="startPage=${currentPage > 2 ? currentPage - 2 : 0},
                                          endPage=${currentPage + 2 < totalPages ? currentPage + 2 : totalPages - 1}">

                            <li th:if="${startPage > 0}" class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>

                            <li class="page-item"
                                th:each="i : ${#numbers.sequence(startPage, endPage)}"
                                th:classappend="${i == currentPage} ? 'active'">
                                <a class="page-link"
                                   th:href="${categoryId != null} ? @{/postsbycategory/{id}(id=${categoryId}, page=${i})} : @{/posts(page=${i})}"
                                   th:text="${i + 1}"
                                   th:if="${i != currentPage}">
                                </a>
                                <span class="page-link" th:if="${i == currentPage}" th:text="${i + 1}"></span>
                            </li>

                            <li th:if="${endPage < totalPages - 1}" class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        </th:block>

                        <!-- Next page -->
                        <li class="page-item" th:classappend="${!hasNext} ? 'disabled'">
                            <a class="page-link"
                               th:href="${categoryId != null} ? @{/postsbycategory/{id}(id=${categoryId}, page=${currentPage + 1})} : @{/posts(page=${currentPage + 1})}"
                               th:if="${hasNext}">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                            <span class="page-link" th:if="${!hasNext}">
                                <span aria-hidden="true">&raquo;</span>
                            </span>
                        </li>

                        <!-- Last page -->
                        <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                            <a class="page-link"
                               th:href="${categoryId != null} ? @{/postsbycategory/{id}(id=${categoryId}, page=${totalPages - 1})} : @{/posts(page=${totalPages - 1})}"
                               th:if="${currentPage < totalPages - 1}">
                                <span aria-hidden="true">&raquo;&raquo;</span>
                            </a>
                            <span class="page-link" th:if="${currentPage == totalPages - 1}">
                                <span aria-hidden="true">&raquo;&raquo;</span>
                            </span>
                        </li>
                    </ul>
                </nav>
            </div>

        </div>
    </section>

</div>
</body>
</html>