<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">

<body>

<div layout:fragment="content">
    <section>
        <div class="container" style="width: 60%; padding-bottom: 30 px;">

            <nav aria-label="breadcrumb">
                <ol class="breadcrumb" style="backgound-color: white; padding-left: 0px">
                    <li class="breadcrumb-item" aria-current="page"><a href="/admin">Admin</a></li>
                    <li class="breadcrumb-item active" aria-current="page">New Post</li>
                </ol>
            </nav>

            <div>

                <th:block th:insert="~{validationMessage}"></th:block>

                <form method="post" th:object="${post}" enctype="multipart/form-data">

                    <div class="form-group">
                        <label for="mainImage">Main Image</label>
                        <input type="file" class="form-control-file" id="mainImage" name="mainImage" accept="image/*" required>
                        <small class="form-text text-muted">Select a main image for the post (optional)</small>

                        <label>Categories</label>
                        <div class="checkbox-group" style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; max-height: 200px; overflow-y: auto;">
                            <div th:each="category : ${categories}" class="form-check">
                                <input type="checkbox"
                                       class="category-checkbox"
                                       th:id="'category_' + ${category.id}"
                                       th:name="categoryIds"
                                       th:value="${category.id}"
                                       th:checked="${#lists.contains(selectedCategoryIds, category.id)}">
                                <label class="form-check-label" th:for="'category_' + ${category.id}" th:text="${category.name}"></label>
                            </div>
                        </div>
                        <small class="form-text text-muted">Select one or more categories</small>

<!--                        <small id="categoryError" class="form-text text-danger" style="display:none;">-->
<!--                            Please select at least one category.-->
<!--                        </small>-->


                        <div id="categoryError" style="color:red; display:none;">Please select at least one category.</div>

                    </div>

                    <div class="form-group">
                        <label for="user">User</label>
                        <select class="form-control" name="user" id="user" th:field="*{user}" required>
                            <option value="">Select a user</option>
                            <option th:each="user : ${users}"
                                    th:value="${user.id}"
                                    th:text="${user.username}">
                            </option>
                        </select>

                        <div th:if="${#fields.hasErrors('user')}" class="invalid-feedback" th:errors="*{user}"></div>

                    </div>

                    <div class="form-group">
                        <label for="status">Status</label>
                        <select class="form-control" name="status" id="status" th:field="*{status}" required>
                            <option value="">Select a status</option>
                            <option value="A">Active</option>
                            <option value="I">Inactive</option>
                        </select>

                        <div th:if="${#fields.hasErrors('status')}" class="invalid-feedback" th:errors="*{status}"></div>

                    </div>

                    <div class="form-group">
                        <label for="title">Title</label>
                        <input type="text" class="form-control" id="title" th:field="*{title}" placeholder="Title *" required>

                        <div th:if="${#fields.hasErrors('title')}" class="invalid-feedback" th:errors="*{title}"></div>

                    </div>

                    <label for="summernote">Body</label>
                    <textarea id="summernote" th:field="*{body}" placeholder="Text *" required></textarea>

                    <div th:if="${#fields.hasErrors('body')}" class="invalid-feedback" th:errors="*{body}"></div>
                    <small class="form-text text-muted">(*) Required</small>
                    <button type="submit" class="btn btn-primary" role="button" style="margin-top: 10px;">Submit</button>
                    <a href="/admin" class="btn btn-light" role="button" style="margin-top: 10px;">Cancel</a>
                </form>
            </div>


        </div>
    </section>
</div>

<!-- Script for Summernote -->
<div layout:fragment="scripts">
    <script th:inline="javascript">
        $(document).ready(function () {

            $('#summernote').summernote({
                height: 300
            });

            $("form").on("submit", function (e) {
                let valid = true;

                let selected = $(".category-checkbox:checked").length;
                if (selected === 0) {
                    $("#categoryError").show();
                    valid = false;
                } else {
                    $("#categoryError").hide();
                }

                if ($('#summernote').summernote('isEmpty')) {
                    alert("The 'Body' is required!");
                    valid = false;
                }

                if (!valid) {
                    e.preventDefault();
                }
            });
        });
    </script>
</div>


</body>
</html>
