<!-- fragments/comment-thread.html -->
<div th:fragment="commentThread(commentList)">
    <div th:each="comment : ${commentList}" class="comment-block mb-3">

        <!-- Comentário -->
        <div class="border rounded p-3 bg-light bg-white">
            <p class="mb-1">
                <strong th:text="${comment.username}">Username</strong> -
                <small class="text-muted ms-2"
                       th:text="${#temporals.format(comment.createdAt, 'dd/MM/yyyy')}">
                </small>
            </p>
            <br>
            <p th:text="${comment.content}" class="mb-0"></p>
            <br>


<!--        botao resposta-->
            <button type="button" class="btn btn-link p-0 mt-2 reply-btn"
                th:attr="data-comment-id=${comment.id}">
                reply
            </button>

<!--        form de resposta (oculto por padrao) -->
            <div class="reply-form mt-3" th:attr="id='reply-form-' + ${comment.id}"
                style="display: none;">
                <form th:action="@{'/posts/' + ${comment.post.id} + '/comments'}"
                    method="post" th:object="${comment}">

                    <input type="hidden" name="parentId" th:value="${comment.id}">

                    <br>

                    <h3 class="card-title" style="font-weight: normal; color=blue; padding-top: 5px;">
                        Comment Reply to <span th:text="${comment.username}"></span>
                    </h3>

                    <div class="form-group">
                        <textarea class="form-control" name="content" placeholder="Your reply *" required></textarea>
                    </div>

                     <div class="form-group">
                        <input type="text" class="form-control mt-2" name="username"
                            placeholder="Your name *" required>
                     </div>

                    <div class="form-group">
                        <input type="email" class="form-control mt-2" name="email"
                               placeholder="Your e-mail *" required>
                    </div>

                    <small class="form-text text-muted">(*) Required</small>

                    <button type="submit" class="btn btn-sm btn-primary mt-2">Post Reply</button>
                    <button type="button" class="btn btn-sm btn-secondary mt-2
                        cancel-reply" th:attr="data-comment-id=${comment.id}">
                        Cancel
                    </button>
                </form>

            </div>

        </div>

        <!-- Respostas (recuadas mais à direita) -->
        <div th:if="${!#lists.isEmpty(comment.replies)}"
             style="margin-left: 40px; padding-left: 15px; border-left: 2px solid rgba(0,0,0,0.1); margin-top: 15px;">
            <div th:replace="~{fragments/comment-thread :: commentThread(${comment.replies})}"></div>
        </div>
    </div>
</div>
